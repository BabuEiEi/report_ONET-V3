<!DOCTYPE html>
<html lang="th">
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>O-NET Management System</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Sarabun', sans-serif; background-color: #f0f2f5; color: #333; overflow-x: hidden; }
    
    /* --- MODERN LOADING SPINNER --- */
    #loading { 
      position: fixed; top:0; left:0; width:100%; height:100%; 
      background: rgba(255, 255, 255, 0.7); 
      backdrop-filter: blur(8px); 
      z-index: 10000; 
      display: flex; flex-direction: column; justify-content: center; align-items: center; 
      transition: opacity 0.4s ease;
    }

    .loader-spinner {
      width: 50px; height: 50px;
      border: 5px solid #e0e0e0;
      border-bottom-color: #198754; 
      border-radius: 50%;
      display: inline-block;
      box-sizing: border-box;
      animation: rotation 1s linear infinite;
      margin-bottom: 15px;
    }

    @keyframes rotation {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-text {
      font-size: 1rem; font-weight: 600; color: #198754; letter-spacing: 1px;
      animation: pulse 1.5s infinite ease-in-out;
    }

    @keyframes pulse {
      0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; }
    }
    
    .swal2-container { z-index: 10001 !important; }
    
    /* --- LOGIN SCREEN --- */
    #loginScreen { 
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
      background: linear-gradient(135deg, #eef2f3 0%, #8e9eab 100%);
      z-index: 9999; display: flex; justify-content: center; align-items: center; 
    }
    .login-card { 
      background: white; padding: 2.5rem; border-radius: 16px; width: 100%; max-width: 400px; 
      box-shadow: 0 20px 40px rgba(0,0,0,0.15); border: none;
    }
    .logo-img { max-height: 90px; margin-bottom: 1rem; width: auto; }

    /* --- SIDEBAR & LAYOUT --- */
    .sidebar, .main-content { transition: all 0.3s ease; display: flex; flex-direction: column; }

    .sidebar { 
      min-height: 100vh; background: #ffffff; border-right: 1px solid #eaeaea;
      box-shadow: 4px 0 15px rgba(0,0,0,0.02); z-index: 100;
    }
    .sidebar-header {
      padding-bottom: 1.5rem; border-bottom: 1px dashed #dee2e6; margin-bottom: 1rem;
      position: relative;
    }
    .sidebar-title { color: #198754; font-weight: 800; letter-spacing: 1px; margin-top: 5px; white-space: nowrap; }
    
    .user-profile-box {
      background-color: #f8f9fa; border-radius: 10px; padding: 10px; margin-top: 10px;
      border: 1px solid #f1f1f1; overflow: hidden;
    }
    .user-role-badge { font-size: 0.75rem; background: #e8f5e9; color: #198754; padding: 2px 8px; border-radius: 10px; }
    
    .nav-link { 
      color: #666; cursor: pointer; padding: 12px 15px; border-radius: 10px; margin-bottom: 5px; 
      font-size: 0.95rem; transition: all 0.2s ease-in-out; display: flex; align-items: center;
      white-space: nowrap; overflow: hidden;
    }
    .nav-link:hover { background-color: #f8f9fa; color: #000; transform: translateX(3px); }
    .nav-link.active { background-color: #e8f5e9; color: #198754; font-weight: 700; box-shadow: 0 2px 5px rgba(25, 135, 84, 0.1); }
    .nav-link i { width: 24px; text-align: center; margin-right: 10px; font-size: 1.1rem; flex-shrink: 0; }
    
    /* --- COLLAPSED MODE STYLES --- */
    body.sidebar-collapsed .sidebar { width: 80px !important; flex: 0 0 80px !important; padding-left: 10px !important; padding-right: 10px !important; }
    body.sidebar-collapsed .main-content { width: calc(100% - 80px) !important; flex: 0 0 calc(100% - 80px) !important; }
    
    /* ✅ เพิ่ม .sidebar-footer เข้าไปในรายการที่ต้องซ่อนเมื่อย่อเมนู */
    body.sidebar-collapsed .sidebar-title, 
    body.sidebar-collapsed .menu-text, 
    body.sidebar-collapsed .user-info-text, 
    body.sidebar-collapsed .btn-logout-text,
    body.sidebar-collapsed .sidebar-footer { 
        display: none !important; 
    }
    
    body.sidebar-collapsed .sidebar-header img { height: 40px; margin-bottom: 5px; }
    body.sidebar-collapsed .nav-link { justify-content: center; padding: 12px 0; }
    body.sidebar-collapsed .nav-link:hover { transform: none; background-color: #e8f5e9; }
    body.sidebar-collapsed .nav-link i { margin-right: 0; font-size: 1.4rem; }
    body.sidebar-collapsed .user-profile-box { padding: 5px; text-align: center; }
    body.sidebar-collapsed .user-profile-box .btn { padding: 5px 0; }
    body.sidebar-collapsed .sidebar-header { padding-bottom: 1rem; margin-bottom: 0.5rem; }

    .hidden { display: none !important; }
    .status-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; }
    .dot-success { background-color: #198754; box-shadow: 0 0 6px #198754; } 
    .dot-empty { background-color: #e9ecef; border: 2px solid #ced4da; } 
    .card-shadow { box-shadow: 0 4px 12px rgba(0,0,0,0.05); border: none; border-radius: 12px; background: white; }
    .fade-in { animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>

  <div id="loading">
    <span class="loader-spinner"></span>
    <div class="loading-text">กำลังประมวลผล...</div>
  </div>

  <div id="loginScreen">
    <div class="login-card text-center fade-in">
      <img src="https://cdn.jsdelivr.net/gh/BabuEiEi/images/image - แก้ไขแล้ว.png" alt="Logo" class="logo-img" onerror="this.src='https://via.placeholder.com/150x80?text=O-NET'">
      <h4 class="text-l font-bold text-gray-800 leading-tight">ระบบบริหารจัดการทดสอบ<br>O-NET ม.6</h4>
      <p class="text-gray-500 text-sm font-medium">(Digital Testing)</p>
      <p class="font-bold mt-2" style="color: #6f42c1; font-size: 14px;">ศูนย์ประสานงานการจัดสอบ<br>สพม.พิษณุโลก อุตรดิตถ์</p>    
      <form onsubmit="event.preventDefault(); doLogin();">
        <div class="form-floating mb-3 text-start">
          <input type="text" class="form-control" id="loginUser" placeholder="Username" required>
          <label>ชื่อผู้ใช้งาน / รหัสโรงเรียน</label>
        </div>
        <div class="form-floating mb-4 text-start">
          <input type="password" class="form-control" id="loginPass" placeholder="Password" required>
          <label>รหัสผ่าน</label>
        </div>
        <button type="submit" class="btn btn-success w-100 py-2 fw-bold shadow-sm">เข้าสู่ระบบ</button>
      </form>
      <div class="mt-8 text-center border-t border-gray-200/60 pt-4">
        <p class="mb-0" style="font-size: 12px; color: #adb5bd;">© 2026 Copyright | พัฒนาโดย นายภัทรพล แก้วเสนา</p>
      </div>
    </div>
  </div>

  <div id="mainApp" class="container-fluid hidden">
    <div class="row">
      <div class="col-md-3 col-lg-2 sidebar p-3 d-none d-md-block">
        <div class="text-center sidebar-header">
           <button class="btn btn-sm btn-light text-secondary position-absolute top-0 end-0 m-0 shadow-sm border" onclick="toggleSidebar()" title="ย่อ/ขยาย เมนู">
             <i class="bi bi-list fs-6"></i>
           </button>

           <img src="https://cdn.jsdelivr.net/gh/BabuEiEi/images/image - แก้ไขแล้ว.png" style="height: 50px;" class="mb-2" onerror="this.style.display='none'">
           <div class="sidebar-title">ระบบบริหารจัดการทดสอบ O-NET</div>
           
           <div class="user-profile-box text-start">
              <div class="d-flex align-items-center justify-content-between mb-2 user-info-text">
                <div>
                   <small class="text-muted d-block" style="font-size: 0.7rem;">ผู้ใช้งานปัจจุบัน</small>
                   <div id="displayUser" class="fw-bold text-dark text-truncate" style="max-width: 120px;">User</div>
                </div>
                <span id="displayRole" class="user-role-badge">Role</span>
              </div>
              <button onclick="doLogout()" class="btn btn-sm btn-outline-danger w-100" style="font-size: 0.8rem;">
                <i class="bi bi-box-arrow-left me-1"></i> <span class="btn-logout-text">ออกจากระบบ</span>
              </button>
           </div>
        </div>

        <ul class="nav flex-column" id="sidebarMenu"></ul>

        <div class="sidebar-footer mt-auto text-center p-3 border-top">
            <small class="text-muted" style="font-size: 0.65rem; display: block; line-height: 1.4;">
                &copy; 2026 Copyright<br>
                พัฒนาโดย นายภัทรพล แก้วเสนา<br>
                ศึกษานิเทศก์ สพม.พิษณุโลก อุตรดิตถ์
            </small>
        </div>

      </div>

      <div class="col-md-9 col-lg-10 ms-sm-auto px-md-4 py-4 main-content">
        <div class="d-md-none mb-3 d-flex align-items-center justify-content-between bg-white p-3 rounded shadow-sm">
           <span class="fw-bold text-success">O-NET System</span>
           <button class="btn btn-outline-secondary btn-sm" onclick="$('.sidebar').toggleClass('d-none')"><i class="bi bi-list"></i></button>
        </div>

        <div class="d-flex justify-content-between align-items-center pb-2 mb-4 border-bottom">
          <h1 class="h4 text-dark mb-0 fw-bold" id="page-title">ยินดีต้อนรับ</h1>
          <div id="action-buttons"></div>
        </div>

        <div id="content-area" style="min-height: 60vh;"></div>
        
        </div>
    </div>
  </div>

  <div class="modal fade" id="dataModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title" id="modalTitle">แบบฟอร์มข้อมูล</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body bg-light">
          <form id="dataForm">
            <div id="formFields" class="row g-3"></div>
            <input type="hidden" id="keyField" name="keyField">
            <input type="hidden" id="keyValue" name="keyValue">
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
          <button type="button" class="btn btn-success" onclick="saveData()">บันทึกข้อมูล</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <?!= include('JavaScript'); ?>
</body>
</html>
